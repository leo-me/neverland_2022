# 定义

1. 在不改变功能的情况下，改善代码结构
2. 提高代码的可读性、可扩展性
3. 重构不是性能优化，对性能的影响可好可坏。性能优化则让程序运行的更快，当然，最终的代码可能更难理解和维护。


驱动重构

介绍背景：

日常代码的重构

1. 一开始都不太会把所有细节都想好

2. 时机：提交cr之前、添加新功能之前

3. 合理的拆分组件




项目级别的重构

1. 落地页的背景
   ssr异构 smarty react -> 同构  体验 会闪一下
   业务迭代 -> 众多历史包袱
   更换技术栈 -> react  to  san

2. 云迹的背景
   需求迭代价大 -> django 模板语言，更新页面，后端更新模板


如何推动重构

1. 让业务方、产品、测试看到开发中的痛点和技术上的瓶颈
2. 让所有人意识到缝缝补补破窗效应导致问题加剧，已经积重难返了
3. 强调重构带来的技术收益和业务收益，强调重构带来的优点：BUG数量减少，维护成本下降，BUG排查变快，开发速度增高等（业务价值才是绩效的根本）
4. 提供切实可行并可控的重构计划方案


制定技术方案
1. 充分调研
2. 选取最合适业务的
3. 最佳实践，例如：typescript

# 搭建脚手架
[工程化](工程化.md)

什么是好的代码

1. 好代码的检验标准就是人们是否能轻而易举地修改它。
2. 好代码应该直截了当：有人需要修改代码时，他们应能轻易找到修改点，应该能快速做出更改，而不易引入其他错误。
3. 一个健康的代码库能够最大限度地提升我们的生产力，支持我们更快、更低成本地为用户添加新特性



什么代码需要重构

破窗效应：原意一个建筑出现破坏的窗户，会诱发更多的人为破坏。及时修理的话，会少受到破坏。

坏味道

1. 重复的代码

2. 过多的if else switch  => 策略模式、多态

3. 过长的组件，组件拆分

4. 纯函数 -> 副作用和纯函数分离，不要改变入参

5. 变量、函数命名，是否清晰，一眼就能理解要做什么

6. 函数
   - 过长的参数 -〉 参数对象
   - 过长的逻辑，函数提炼

7. 没有空行，合理的分区 和 空行




涉及的设计模式，做了什么事情


1. 策略模式 -> 替代过长的 switch 和 很多的if else

一个函数有上百行的代码，函数里有大量的if else，如果让你增加一个功能，你更倾向于直接在目标函数上加入你的改动代码，而不是通读该方法，再进行封装修改呢。

其实这样的修改方式，并没有错，也和个人能力没有关系，因为这种修改方式是最保险，最快捷的，他不但维持代码原有功能正常运行，还添加了新的功能。

但是，这样的项目，就是典型的破窗效应，因为第一个人产生了破窗，没有及时修复，后面来的人，就会更大胆的破坏，最终项目没法维护。




2. 单例模式, 惰性单例
   redux
   需要时再创建
   一个modal


3. 工厂模式





怎么保证重构不引入新的bug

1. 单元测试
2. 端到端测试、灰度测试
3. 逐渐放量



参考书目

《代码整洁之道》
《重构 - 改善既有代码的设计》









